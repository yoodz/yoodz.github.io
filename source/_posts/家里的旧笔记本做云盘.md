---
title: 家里的旧笔记本做云盘
abbrlink: 137f79b6
date: 2023-07-22 18:06:14
categories: 折腾记
---

- 旧笔记本重装centos/ubuntu系统
- 打个电话跟运营商要公网ip，获得动态IP
- 购买域名指向动态IP，定时跑脚本更新最新外网IP。DDNS
- 系统装开源网盘系统，可道云
- 路由器配置端口转发，把云盘的端口暴漏出去
- 大功告成

我手里有一台大学时候的旧笔记本，型号是联想的G510，已经用了很多年了，一次问题都没有出过。联想还是比较靠谱的，之前我也给这台电脑升级过一些配置，到目前为止内存8G，另外加了128G的固态。这个配置放到今天跑windows那是很低了，但是如果装一个无界面版的linux，那还是绰绰有余的。

# 笔记本安装 ubuntu

去[官网](https://ubuntu.com/#download)找镜像，把镜像装到U盘里做启动盘，进入系统安装下一步下一步下一步...，最后就是装入ssh server，可以远程访问就算大功告成啦~
# 获取公网ip
我家庭网络选用的网络运营商是中国联通，为了可以一次成功地要到公网ip，也查看了网上的一些经验，大多数情况下都是建议拿装监控为理由申请的，正常情况下打电话验证个人信息就能够申请到（如果不知道宽带的账号密码，也可以直接跟客服要），等客服回复电话说修改成功就可以了。
在要到公网ip后还要记得将光猫改成[桥接模式](https://zhuanlan.zhihu.com/p/358075010#:~:text=%E5%85%89%E7%8C%AB%E8%AE%BE%E7%BD%AE%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F,%E8%AE%BE%E5%A4%87%E7%9A%84%E8%BF%9E%E6%8E%A5%E5%92%8C%E8%B0%83%E8%AF%95%E3%80%82)，并用路由器进行拨号上网（主要是需要借助这个路由器进行端口转发），这样的话路由器就算是直接接入公网了。

![Untitled](https://static.afunny.top/2023/202307221808028.png)

光猫设置桥接模式

![Untitled](https://static.afunny.top/2023/202307221808029.png)

小米路由器拨号上网

# 更新DDNS

因为运营商分配的外网IP是不固定的，所以需要设置DDNS（动态域名解析）。基本原理就是内网定期（每分钟）检查外网ip地址，和上次的IP地址做比较，如果IP地址变化了，就调用域名提供商的接口，更新域名解析的IP地址，这样就保证域名可以始终解析到正确的IP上。

1. 阿里云购买域名
2. 获取AK/SK
3. 服务器启动docker容器（[aliyun-ddns](https://github.com/sanjusss/aliyun-ddns)）

做完这一步你的域名就能够稳定的访问到家里的网络了。

# 开源网盘，可道云

KodExplorer可道云，原名芒果云，是基于Web技术的私有云在线文档管理解决方案。用户只需通过简单环境搭建，即可使用KodExplorer快速完成私有云/私有网盘/在线文档管理系统的部署和搭建。KOD提供了类windows用户界面，延续了windows平台的操作逻辑和使用习惯，支持100余种文件格式的在线预览，使得用户的私有云产品可以拥有本地操作一样方便、快捷、安全的体验。同时也提供移动端APP支持。

[文档地址](https://kodcloud.com/download/) [镜像地址](https://hub.docker.com/r/kodcloud/kodbox)

安装安装文档启动镜像，配置挂载目录（也支持扩展外置硬盘），记录启动的端口。

![Untitled](https://static.afunny.top/2023/202307221808030.png)

# 端口转发
路由器配置端口转发，把云盘的端口暴漏出去。在路由器-高级设计-端口转发，将上一步启动的端口暴露出去。

![Untitled](https://static.afunny.top/2023/202307221808031.png)

# 大功告成

这样就完成了，外网访问家里网络的设置。体验总结：包年的宽带在我们不在家的时候就闲置了，搭一套云盘也提高了宽带利用率。另外近几年外网云盘纷纷陨落，搭建一个私有云盘即便宜又安全，可以随时把手机里的图片视频同步到家里的电脑，减少手机存储负担。资料存储在自己的服务器也比较放心。